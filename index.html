
<!DOCTYPE html>
<html>

<head>
  <title>Web3Auth Getting Started</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">
    <h1 class="title">
      <a target="_blank" href="https://web3auth.io/docs/sdk/pnp/web/modal">Web3Auth</a> & JS Ethereum
      Example
    </h1>
    <!-- Logged In -->
    <div class="grid btn-logged-in">
      <button id="get-user-info" class="btn">Get User Info</button>
      <button id="get-accounts" class="btn">Get Accounts</button>
      <button id="get-balance" class="btn">Get Balance</button>
      <button id="sign-message" class="btn">Sign Message</button>
      <button id="show-wallet" class="btn">Show Wallet</button>
      
      <button id="logout" class="btn">Logout</button>
      <div class="console" id="console">
        <p id="code" class="code"></p>
      </div>
    </div>

    <!-- Logged Logout -->
    <div class="grid btn-logged-out">
      <button id="login" class="btn">Login</button>
    </div>
    <footer class="footer">
      <a href="https://github.com/Web3Auth/web3auth-pnp-examples/tree/main/web-modal-sdk/quick-starts/vanillajs-modal-quick-start"
        target="_blank" rel="noopener noreferrer">
        Source code
      </a>
      <a href="https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2FWeb3Auth%2Fweb3auth-pnp-examples%2Ftree%2Fmain%2Fweb-modal-sdk%2Fquick-starts%2Fvanillajs-modal-quick-start&project-name=w3a-vanillajs-modal&repository-name=w3a-vanillajs-modal">
        <img src="https://vercel.com/button" alt="Deploy with Vercel" />
      </a>
    </footer>
  </div>

  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="https://unpkg.com/base64-js@1.5.1/base64js.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/modal"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/wallet-services-plugin"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/ethereum-provider"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@4.1.1/dist/web3.min.js"></script>
  
  <script>
let web3auth = null;
let walletServicesPlugin = null;

(async function init() {
  $(".btn-logged-in").hide();
  $("#sign-tx").hide();

  const clientId = "BKFLAA4PxFOm-tmlwmXOwC35iB1rLyWAaq7cjUjjz13wCh1zcGJz3JVJKcWdHiKq98QndXv7gUYpP94HoDmB1cg"; // get your clientId from https://dashboard.web3auth.io

  const chainConfig = {
    chainNamespace: "eip155",
    chainId: "0x7a31c7",
    rpcTarget: "https://api.helium.fhenix.zone",
    // Avoid using public rpcTarget in production.
    // Use services like Infura, Quicknode etc
    displayName: "Fhenix Helium Testnet",
    blockExplorerUrl: "https://explorer.helium.fhenix.zone/",
    ticker: "tFHE",
    tickerName: "tFhenix",
    logo: "https://img.cryptorank.io/coins/fhenix1695737384486.png",
  };

  const privateKeyProvider = new window.EthereumProvider.EthereumPrivateKeyProvider({ config: { chainConfig } });
    console.log(privateKeyProvider);
  web3auth = new window.Modal.Web3Auth({
    clientId,
    privateKeyProvider,
    web3AuthNetwork: "sapphire_mainnet",
  });

  // Add wallet service plugin
  walletServicesPlugin = new window.WalletServicesPlugin.WalletServicesPlugin();
  web3auth.addPlugin(walletServicesPlugin); // Add the plugin to web3auth

  await web3auth.initModal();

  if (web3auth.connected) {
    $(".btn-logged-in").show();
    $(".btn-logged-out").hide();
    if (web3auth.connected === "openlogin") {
      $("#sign-tx").show();
    }
  } else {
    $(".btn-logged-out").show();
    $(".btn-logged-in").hide();
  }
})();

$("#login").click(async function (event) {
  try {
    await web3auth.connect();
    $(".btn-logged-out").hide();
    $(".btn-logged-in").show();
    uiConsole("Logged in Successfully!");
  } catch (error) {
    console.error(error.message);
  }
});

$("#get-user-info").click(async function (event) {
  try {
    const user = await web3auth.getUserInfo();
    uiConsole(user);
  } catch (error) {
    console.error(error.message);
  }
});

$("#get-accounts").click(async function (event) {
  try {
    const web3 = new Web3(web3auth.provider);

    // Get user's Ethereum public address
    const address = await web3.eth.getAccounts();
    uiConsole(address);
  } catch (error) {
    console.error(error.message);
  }
});

$("#get-balance").click(async function (event) {
  try {
    const web3 = new Web3(web3auth.provider);

    // Get user's Ethereum public address
    const address = (await web3.eth.getAccounts())[0];

    // Get user's balance in ether
    const balance = web3.utils.fromWei(
      await web3.eth.getBalance(address), // Balance is in wei
      "ether"
    );
    uiConsole(balance);
  } catch (error) {
    console.error(error.message);
  }
});

$("#show-wallet").click(async function (event) {
  // print status in console
  uiConsole(walletServicesPlugin.status);
  if (walletServicesPlugin.status == "connected") {
    // check if wallet is connected
    await walletServicesPlugin.showWalletUi();
  }
});

$("#sign-message").click(async function (event) {
  try {
    const web3 = new Web3(web3auth.provider);
    // Get user's Ethereum public address
    const fromAddress = (await web3.eth.getAccounts())[0];

    const originalMessage = "YOUR_MESSAGE";

    // Sign the message
    const signedMessage = await web3.eth.personal.sign(
      originalMessage,
      fromAddress,
      "test password!" // configure your own password here.
    );
    uiConsole(signedMessage);
  } catch (error) {
    console.error(error.message);
  }
});

$("#logout").click(async function (event) {
  try {
    await web3auth.logout();
    $(".btn-logged-in").hide();
    $(".btn-logged-out").show();
  } catch (error) {
    console.error(error.message);
  }
});

function uiConsole(...args) {
  const el = document.querySelector("#console>p");
  if (el) {
    el.innerHTML = JSON.stringify(args || {}, null, 2);
    console.log(...args);
  }
}
  </script>
</body>

</html>
